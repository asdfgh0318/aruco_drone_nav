<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Debug Viewer Guide - ArUco Vision GPS</title>
    <link rel="stylesheet" href="style.css">
</head>
<body>
    <nav>
        <div class="container">
            <a href="index.html" class="logo">ArUco<span>Nav</span></a>
            <ul>
                <li><a href="index.html">Home</a></li>
                <li><a href="gui-guide.html" class="active">Debug Viewer</a></li>
                <li><a href="calibration.html">Calibration</a></li>
                <li><a href="sitl.html">SITL Testing</a></li>
                <li><a href="https://github.com/asdfgh0318/aruco_drone_nav">GitHub</a></li>
            </ul>
        </div>
    </nav>

    <main>
        <h1>Debug Viewer Guide</h1>
        <p>The debug viewer captures frames from the RPi HTTP stream for remote debugging and testing of ArUco marker detection.</p>

        <h2>Prerequisites</h2>
        <p>Install required Python packages on your local machine:</p>
        <pre><code>pip install opencv-python numpy requests</code></pre>

        <h2>Starting the System</h2>

        <h3>Step 1: Start Stream Mode on RPi</h3>
        <pre><code># SSH into the RPi
ssh aruconav@aruconav.local

# Navigate to project directory
cd /home/aruconav/aruco_drone_nav

# Start stream mode (HTTP server on port 8001)
python3 -m src --mode stream --port 8001</code></pre>

        <h3>Step 2: Launch Debug Viewer</h3>
        <pre><code># On your local machine
python3 tools/debug_viewer.py --host aruconav.local --port 8001</code></pre>

        <h2>Available Endpoints</h2>
        <table>
            <tr>
                <th>Endpoint</th>
                <th>Response</th>
            </tr>
            <tr>
                <td><code>GET /position</code></td>
                <td>JSON with x, y, z, yaw, confidence, timing, detection_rate</td>
            </tr>
            <tr>
                <td><code>GET /debug-frame</code></td>
                <td>JPEG image from camera with detection overlay</td>
            </tr>
        </table>

        <h2>Sample Output</h2>
        <pre><code>curl http://aruconav.local:8001/position

{
  "x": 0.549, "y": -0.289, "z": 1.712,
  "yaw": 159.2, "marker_ids": ["0"], "confidence": 1.0,
  "detection_rate": 1.0, "uptime": 10.4,
  "timing": {"gray": "5", "clahe": "21", "detect": "107", "total": "134"}
}</code></pre>

        <h2>Live Detection Example</h2>
        <img src="images/detection_live.jpg" alt="ArUco Marker Detection from RPi camera" class="screenshot">
        <p><em>Live camera view from RPi Zero 2W showing ArUco marker ID 0 detected on ceiling at ~1.7m distance.</em></p>

        <h2>Troubleshooting</h2>

        <h3>No Connection</h3>
        <ul>
            <li>Verify stream is running on RPi: <code>curl http://aruconav.local:8001/position</code></li>
            <li>Check network connectivity: <code>ping aruconav.local</code></li>
            <li>Ensure port 8001 is not blocked by firewall</li>
        </ul>

        <h3>Low Detection Rate</h3>
        <ul>
            <li>Improve lighting conditions</li>
            <li>Ensure markers are flat (not curved or wrinkled)</li>
            <li>Optimal distance: 1.5-2.5m from camera to ceiling marker</li>
            <li>CLAHE preprocessing handles most lighting variations</li>
        </ul>

        <div class="tip">
            <strong>Tip:</strong> For best results, ensure the markers are well-lit with diffuse lighting. Direct sunlight or shadows can reduce detection rate.
        </div>
    </main>

    <footer>
        <p>ArUco Vision GPS &copy; 2026 Warsaw University of Technology</p>
        <p>Authors: Adam Koszalka &amp; Claude Code</p>
    </footer>
</body>
</html>
