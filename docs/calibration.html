<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Camera Calibration - ArUco Vision GPS</title>
    <link rel="stylesheet" href="style.css">
</head>
<body>
    <nav>
        <div class="container">
            <a href="index.html" class="logo">ArUco<span>Nav</span></a>
            <ul>
                <li><a href="index.html">Home</a></li>
                <li><a href="gui-guide.html">Debug Viewer</a></li>
                <li><a href="calibration.html" class="active">Calibration</a></li>
                <li><a href="sitl.html">SITL Testing</a></li>
                <li><a href="https://github.com/asdfgh0318/aruco_drone_nav">GitHub</a></li>
            </ul>
        </div>
    </nav>

    <main>
        <h1>Camera Calibration Guide</h1>
        <p>Camera calibration is essential for accurate pose estimation. This guide explains how to calibrate your camera using the chessboard pattern.</p>

        <h2>Why Calibrate?</h2>
        <p>Camera calibration determines:</p>
        <ul>
            <li><strong>Intrinsic parameters</strong> - Focal length (fx, fy) and optical center (cx, cy)</li>
            <li><strong>Distortion coefficients</strong> - Lens distortion correction (radial and tangential)</li>
        </ul>
        <p>Without proper calibration, pose estimation will be inaccurate, leading to navigation errors.</p>

        <h2>Calibration Pattern</h2>
        <p>The system uses a 9x6 chessboard pattern (inner corners).</p>

        <h3>Printing the Pattern</h3>
        <ol>
            <li>Open <code>markers/chessboard_9x6.pdf</code></li>
            <li>Print at <strong>100% scale</strong> (no scaling)</li>
            <li>Mount on a flat, rigid surface (cardboard, foam board)</li>
            <li>Verify square size is 25mm (measure with ruler)</li>
        </ol>

        <div class="warning">
            <strong>Important:</strong> The chessboard must be completely flat. Any warping will introduce calibration errors.
        </div>

        <h2>Remote Calibration (Recommended)</h2>
        <p>Calibrate the RPi camera over the network without needing physical access.</p>

        <h3>Prerequisites</h3>
        <ol>
            <li>Camera server running on RPi</li>
            <li>Printed chessboard pattern</li>
            <li>Network connection to RPi</li>
        </ol>

        <h3>Step 1: Start Camera Server</h3>
        <pre><code>ssh aruconav@aruconav.local
cd /home/aruconav/aruco_drone_nav
python3 tools/camera_server.py --port 8000</code></pre>

        <h3>Step 2: Run Calibration Tool</h3>
        <pre><code>python3 tools/calibrate_remote.py --host aruconav.local --port 8000</code></pre>

        <h3>Step 3: Capture Calibration Images</h3>
        <ol>
            <li>Hold the chessboard in view of the camera</li>
            <li>When corners are detected, they appear <strong style="color: green;">GREEN</strong></li>
            <li>Press <strong>SPACE</strong> to capture the frame</li>
            <li>Move the board to different positions and angles</li>
            <li>Capture at least <strong>10 images</strong> from various angles</li>
        </ol>

        <h3>Recommended Capture Positions</h3>
        <ul>
            <li>Center of frame, parallel to camera</li>
            <li>Left/Right/Top/Bottom of frame</li>
            <li>Tilted at 20-30 degrees in various directions</li>
            <li>Close (fills 80% of frame) and far (fills 30%)</li>
        </ul>

        <div class="tip">
            <strong>Tip:</strong> Cover the entire field of view with captures. This ensures accurate distortion correction across the whole image.
        </div>

        <h3>Step 4: Run Calibration</h3>
        <ol>
            <li>After capturing 10+ images, press <strong>C</strong> to calibrate</li>
            <li>Calibration computes camera matrix and distortion coefficients</li>
            <li>Results are saved to <code>config/camera_params.yaml</code></li>
        </ol>

        <h2>Understanding Results</h2>

        <h3>Reprojection Error</h3>
        <table>
            <tr>
                <th>Error</th>
                <th>Quality</th>
            </tr>
            <tr>
                <td>&lt; 0.5 px</td>
                <td>Excellent</td>
            </tr>
            <tr>
                <td>0.5 - 1.0 px</td>
                <td>Good</td>
            </tr>
            <tr>
                <td>1.0 - 2.0 px</td>
                <td>Acceptable</td>
            </tr>
            <tr>
                <td>&gt; 2.0 px</td>
                <td>Poor - recalibrate</td>
            </tr>
        </table>

        <div class="note">
            <strong>Current Calibration:</strong> 720p calibration with 0.14 reprojection error (excellent).
        </div>

        <h2>Local Calibration</h2>
        <p>If you have direct access to the camera (USB connected to your machine):</p>
        <pre><code>python3 tools/calibrate_camera.py --camera 0 --output config/camera_params.yaml</code></pre>

        <h2>Verifying Calibration</h2>
        <ol>
            <li>Run stream mode on RPi: <code>python3 -m src --mode stream --port 8001</code></li>
            <li>Check distance in JSON: <code>curl http://aruconav.local:8001/position</code></li>
            <li>Verify the reported z distance matches actual ceiling height</li>
        </ol>

        <h2>Troubleshooting</h2>

        <h3>Corners Not Detected</h3>
        <ul>
            <li>Improve lighting (avoid shadows)</li>
            <li>Ensure entire chessboard is visible in frame</li>
            <li>Make sure pattern is flat</li>
            <li>Check for reflections on glossy paper</li>
        </ul>

        <h3>High Reprojection Error</h3>
        <ul>
            <li>Recalibrate with more images (15-20)</li>
            <li>Ensure chessboard is perfectly flat</li>
            <li>Avoid motion blur - hold pattern steady</li>
            <li>Cover more of the field of view</li>
        </ul>
    </main>

    <footer>
        <p>ArUco Vision GPS &copy; 2026 Warsaw University of Technology</p>
        <p>Authors: Adam Koszalka &amp; Claude Code</p>
    </footer>
</body>
</html>
